{{- $cfg := site.Params.analytics.plausible -}}
{{- if $cfg -}}
  {{- $script := default "https://plausible.io/js/script.js" $cfg.scriptURI -}}
  {{- if $cfg.hashedScript -}}
    <script defer data-domain="{{ $cfg.domain }}"{{ with $cfg.apiURI }} data-api="{{ . | safeHTMLAttr }}"{{ end }} src="{{ $script | safeURL }}"></script>
    <script>
      window.plausible = window.plausible || function () {
        (plausible.q = plausible.q || []).push(arguments)
      }
      plausible.init = plausible.init || function (initOptions) {
        plausible.o = initOptions || {}
      }
      plausible.init()
    </script>
  {{- else if $cfg.domain -}}
    <script defer data-domain="{{ $cfg.domain }}"{{ with $cfg.apiURI }} data-api="{{ . | safeHTMLAttr }}"{{ end }} src="{{ $script | safeURL }}"></script>
  {{- end -}}
{{- end -}}
